================================================================================
                    FIX: "Failed to create order" ERROR
================================================================================

ISSUE: When trying to place an order, you get:
       {"message":"Failed to create order"}

CAUSE: Supabase Row Level Security (RLS) policies are not configured for
       public order creation.

SOLUTION: Run one SQL command in Supabase

================================================================================
                              STEP-BY-STEP FIX
================================================================================

STEP 1: Open Supabase SQL Editor
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. Go to https://supabase.com
  2. Login to your account
  3. Open your project: "nzportuamtrburumshvg"
  4. Click on "SQL Editor" (left sidebar)
  5. Click "+ New Query" button

STEP 2: Copy the SQL Code
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Copy this entire SQL (it's in the next section):

STEP 3: Paste in Supabase
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. Paste the SQL in the SQL Editor
  2. Click "Run" button (or press Ctrl+Enter)
  3. Wait for "Success" message

STEP 4: Test Your App
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. Refresh your browser: http://localhost:3000
  2. Add a product to cart
  3. Go to checkout
  4. Fill the form with test data:
     - Name: Test User
     - Email: test@test.com
     - Phone: 9876543210
     - Address: 123 Main Street
     - City: Delhi
     - State: Delhi
     - Pincode: 110001
  5. Select "Cash on Delivery"
  6. Click "Place Order"
  7. You should see confirmation page âœ…

================================================================================
                          SQL CODE TO RUN
================================================================================

Copy everything between the dashes and paste in Supabase SQL Editor:

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- Enable RLS and create policies for order creation

ALTER TABLE orders ENABLE ROW LEVEL SECURITY;
DROP POLICY IF EXISTS "Public can create orders" ON orders;
CREATE POLICY "Public can create orders"
  ON orders FOR INSERT
  WITH CHECK (true);

ALTER TABLE order_items ENABLE ROW LEVEL SECURITY;
DROP POLICY IF EXISTS "Public can create order items" ON order_items;
CREATE POLICY "Public can create order items"
  ON order_items FOR INSERT
  WITH CHECK (true);

ALTER TABLE product_variants ENABLE ROW LEVEL SECURITY;
DROP POLICY IF EXISTS "Public can update variants" ON product_variants;
CREATE POLICY "Public can update variants"
  ON product_variants FOR UPDATE
  USING (true)
  WITH CHECK (true);
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

That's it! Just run this SQL and your order creation will work.

================================================================================
                           VERIFY IT WORKED
================================================================================

After running the SQL and testing:

1. Go to Supabase Console
2. Click "orders" table
3. You should see your test order there with:
   - order_number: ORD-20251126-00001 (or similar)
   - customer_name: Test User
   - total: Amount paid

4. Click "order_items" table
5. You should see items from your order

If you see these, it worked! âœ…

================================================================================
                          STILL HAVING ISSUES?
================================================================================

CHECK 1: Verify Supabase Connection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â€¢ Check .env.local has correct SUPABASE_URL and SUPABASE_ANON_KEY
  â€¢ Make sure they match your project

CHECK 2: Verify Database Tables Exist
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â€¢ Go to Supabase Console
  â€¢ Click "Database" â†’ "Tables"
  â€¢ You should see: orders, order_items, products, product_variants, categories

CHECK 3: Check Server Error Logs
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â€¢ Look at terminal where you ran "npm run dev"
  â€¢ Search for error messages
  â€¢ Common errors:
    - "relation orders does not exist" â†’ Tables not created
    - "permission denied" â†’ RLS policy not set
    - "Invalid JWT" â†’ Wrong Supabase keys

IF STUCK: See TROUBLESHOOT_ORDER_ERROR.md for detailed debugging

================================================================================
                              SUCCESS! âœ…
================================================================================

Once the SQL runs successfully:
  âœ“ Orders can be created
  âœ“ Order items saved
  âœ“ Stock reduced automatically
  âœ“ Confirmation page shows order details
  âœ“ Checkout flow works end-to-end

You can now test:
  â€¢ COD (Cash on Delivery) orders
  â€¢ Razorpay payment flow (if keys added)
  â€¢ Form validation
  â€¢ Database integration
  â€¢ Full checkout experience

================================================================================
                            NEXT: TEST FLOW
================================================================================

After this fix works, test the complete checkout:

1. Add products to cart
2. Click "Proceed to Checkout"
3. Fill shipping form
4. Select payment method:
   - COD: Direct confirmation
   - Online: Razorpay modal
5. Place order
6. See confirmation page
7. Verify order in database

All should work! âœ…

================================================================================

Need help? Check the documentation files:
  - FIX_ORDER_ERROR_QUICK.md (quick summary)
  - TROUBLESHOOT_ORDER_ERROR.md (detailed help)
  - CHECKOUT_GUIDE.md (complete technical guide)

Good luck! ðŸš€
